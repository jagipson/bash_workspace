txthi[0]='\e[38;2;0;255;255m'
txthi[1]='\e[38;2;3;248;251m'
txthi[2]='\e[38;2;6;241;248m'
txthi[3]='\e[38;2;10;234;244m'
txthi[4]='\e[38;2;13;228;241m'
txthi[5]='\e[38;2;16;221;238m'
txthi[6]='\e[38;2;20;214;234m'
txthi[7]='\e[38;2;23;208;231m'
txthi[8]='\e[38;2;26;201;228m'
txthi[9]='\e[38;2;30;194;224m'
txthi[10]='\e[38;2;33;187;221m'
txthi[11]='\e[38;2;36;181;218m'
txthi[12]='\e[38;2;40;174;214m'
txthi[13]='\e[38;2;43;167;211m'
txthi[14]='\e[38;2;46;161;208m'
txthi[15]='\e[38;2;50;154;204m'
txthi[16]='\e[38;2;53;147;201m'
txthi[17]='\e[38;2;57;140;197m'
txthi[18]='\e[38;2;60;134;194m'
txthi[19]='\e[38;2;63;127;191m'
txthi[20]='\e[38;2;67;120;187m'
txthi[21]='\e[38;2;70;114;184m'
txthi[22]='\e[38;2;73;107;181m'
txthi[23]='\e[38;2;77;100;177m'
txthi[24]='\e[38;2;80;93;174m'
txthi[25]='\e[38;2;83;87;171m'
txthi[26]='\e[38;2;87;80;167m'
txthi[27]='\e[38;2;90;73;164m'
txthi[28]='\e[38;2;93;67;161m'
txthi[29]='\e[38;2;97;60;157m'
txthi[30]='\e[38;2;100;53;154m'
txthi[31]='\e[38;2;104;46;150m'
txthi[32]='\e[38;2;107;40;147m'
txthi[33]='\e[38;2;110;33;144m'
txthi[34]='\e[38;2;114;26;140m'
txthi[35]='\e[38;2;117;20;137m'
txthi[36]='\e[38;2;120;13;134m'
txthi[37]='\e[38;2;124;6;130m'
txthi[38]='\e[38;2;127;0;127m'
txthi[39]='\e[38;2;130;6;124m'
txthi[40]='\e[38;2;134;13;120m'
txthi[41]='\e[38;2;137;20;117m'
txthi[42]='\e[38;2;140;26;114m'
txthi[43]='\e[38;2;144;33;110m'
txthi[44]='\e[38;2;147;40;107m'
txthi[45]='\e[38;2;150;46;104m'
txthi[46]='\e[38;2;154;53;100m'
txthi[47]='\e[38;2;157;60;97m'
txthi[48]='\e[38;2;161;67;93m'
txthi[49]='\e[38;2;164;73;90m'
txthi[50]='\e[38;2;167;80;87m'
txthi[51]='\e[38;2;171;87;83m'
txthi[52]='\e[38;2;174;93;80m'
txthi[53]='\e[38;2;177;100;77m'
txthi[54]='\e[38;2;181;107;73m'
txthi[55]='\e[38;2;184;114;70m'
txthi[56]='\e[38;2;187;120;67m'
txthi[57]='\e[38;2;191;127;63m'
txthi[58]='\e[38;2;194;134;60m'
txthi[59]='\e[38;2;197;140;57m'
txthi[60]='\e[38;2;201;147;53m'
txthi[61]='\e[38;2;204;154;50m'
txthi[62]='\e[38;2;208;161;46m'
txthi[63]='\e[38;2;211;167;43m'
txthi[64]='\e[38;2;214;174;40m'
txthi[65]='\e[38;2;218;181;36m'
txthi[66]='\e[38;2;221;187;33m'
txthi[67]='\e[38;2;224;194;30m'
txthi[68]='\e[38;2;228;201;26m'
txthi[69]='\e[38;2;231;208;23m'
txthi[70]='\e[38;2;234;214;20m'
txthi[71]='\e[38;2;238;221;16m'
txthi[72]='\e[38;2;241;228;13m'
txthi[73]='\e[38;2;244;234;10m'
txthi[74]='\e[38;2;248;241;6m'
txthi[75]='\e[38;2;251;248;3m'
txthi[76]='\e[38;2;255;255;0m'
bakhi[0]='\e[48;2;255;0;0m'
bakhi[1]='\e[48;2;251;6;3m'
bakhi[2]='\e[48;2;248;13;6m'
bakhi[3]='\e[48;2;244;20;10m'
bakhi[4]='\e[48;2;241;26;13m'
bakhi[5]='\e[48;2;238;33;16m'
bakhi[6]='\e[48;2;234;40;20m'
bakhi[7]='\e[48;2;231;46;23m'
bakhi[8]='\e[48;2;228;53;26m'
bakhi[9]='\e[48;2;224;60;30m'
bakhi[10]='\e[48;2;221;67;33m'
bakhi[11]='\e[48;2;218;73;36m'
bakhi[12]='\e[48;2;214;80;40m'
bakhi[13]='\e[48;2;211;87;43m'
bakhi[14]='\e[48;2;208;93;46m'
bakhi[15]='\e[48;2;204;100;50m'
bakhi[16]='\e[48;2;201;107;53m'
bakhi[17]='\e[48;2;197;114;57m'
bakhi[18]='\e[48;2;194;120;60m'
bakhi[19]='\e[48;2;191;127;63m'
bakhi[20]='\e[48;2;187;134;67m'
bakhi[21]='\e[48;2;184;140;70m'
bakhi[22]='\e[48;2;181;147;73m'
bakhi[23]='\e[48;2;177;154;77m'
bakhi[24]='\e[48;2;174;161;80m'
bakhi[25]='\e[48;2;171;167;83m'
bakhi[26]='\e[48;2;167;174;87m'
bakhi[27]='\e[48;2;164;181;90m'
bakhi[28]='\e[48;2;161;187;93m'
bakhi[29]='\e[48;2;157;194;97m'
bakhi[30]='\e[48;2;154;201;100m'
bakhi[31]='\e[48;2;150;208;104m'
bakhi[32]='\e[48;2;147;214;107m'
bakhi[33]='\e[48;2;144;221;110m'
bakhi[34]='\e[48;2;140;228;114m'
bakhi[35]='\e[48;2;137;234;117m'
bakhi[36]='\e[48;2;134;241;120m'
bakhi[37]='\e[48;2;130;248;124m'
bakhi[38]='\e[48;2;127;255;127m'
bakhi[39]='\e[48;2;124;248;130m'
bakhi[40]='\e[48;2;120;241;134m'
bakhi[41]='\e[48;2;117;234;137m'
bakhi[42]='\e[48;2;114;228;140m'
bakhi[43]='\e[48;2;110;221;144m'
bakhi[44]='\e[48;2;107;214;147m'
bakhi[45]='\e[48;2;104;208;150m'
bakhi[46]='\e[48;2;100;201;154m'
bakhi[47]='\e[48;2;97;194;157m'
bakhi[48]='\e[48;2;93;187;161m'
bakhi[49]='\e[48;2;90;181;164m'
bakhi[50]='\e[48;2;87;174;167m'
bakhi[51]='\e[48;2;83;167;171m'
bakhi[52]='\e[48;2;80;161;174m'
bakhi[53]='\e[48;2;77;154;177m'
bakhi[54]='\e[48;2;73;147;181m'
bakhi[55]='\e[48;2;70;140;184m'
bakhi[56]='\e[48;2;67;134;187m'
bakhi[57]='\e[48;2;63;127;191m'
bakhi[58]='\e[48;2;60;120;194m'
bakhi[59]='\e[48;2;57;114;197m'
bakhi[60]='\e[48;2;53;107;201m'
bakhi[61]='\e[48;2;50;100;204m'
bakhi[62]='\e[48;2;46;93;208m'
bakhi[63]='\e[48;2;43;87;211m'
bakhi[64]='\e[48;2;40;80;214m'
bakhi[65]='\e[48;2;36;73;218m'
bakhi[66]='\e[48;2;33;67;221m'
bakhi[67]='\e[48;2;30;60;224m'
bakhi[68]='\e[48;2;26;53;228m'
bakhi[69]='\e[48;2;23;46;231m'
bakhi[70]='\e[48;2;20;40;234m'
bakhi[71]='\e[48;2;16;33;238m'
bakhi[72]='\e[48;2;13;26;241m'
bakhi[73]='\e[48;2;10;20;244m'
bakhi[74]='\e[48;2;6;13;248m'
bakhi[75]='\e[48;2;3;6;251m'
bakhi[76]='\e[48;2;0;0;255m'

# Cache directory checksums in an associative array
declare -A __dirsum_cache

__colorize_pwd()
{
  local p i
  colorprompt=
  IFS='/' read -a p <<<"${PWD/#"$HOME"/$'~'}"
  for i in "${p[@]}"; do
    [[ ! $i ]] && continue
    if [[ $i == '~' ]]; then
      printf -v colorprompt "~" && continue
    fi
    # Our \1 and \2 correspond to \[ and \] (See man bash PROMPTING) but because it's
    # wrapped in a var, \[ and \] don't get interpreted correctly. Geirha suggested using
    # the undocumented \1 and \2 instead.
    printf -v colorprompt '%s/\1%b\2%s\1%b\2' "$colorprompt" \
      "${txthi[$(( ${__dirsum_cache[$i]:=$(cksum - <<<"$i" | cut -f1 -d' ')} % 78))]}"\
      "$i" "$txtrst"
  done
}

